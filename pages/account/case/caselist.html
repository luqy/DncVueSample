<!DOCTYPE html>

<html>

<head>
    <meta name="viewport" content="width=device-width" />
    <title>用例列表</title>
    <link rel="stylesheet" type="text/css" href="../../../assets/iview/iview-3.1.0/styles/iview.css" />
    <script src="../../../assets/vue/vue-2.5.17.min.js"></script>
    <script src="../../../assets/iview/iview-3.1.0/iview.min.js"></script>
    <script src="../../../assets/axios/axios.js"></script>
    <script src="../../../js/config.js"></script>
</head>

<body>
<div id="app">
    <i-Button type="primary" @click="modal1 = true">添加用例</i-Button>
    <Modal
            v-model="modal1"
            title="添加用例"
            @on-ok="ok"
            @on-cancel="cancel"

    >
        <i-form ref="formValidate" :model="formValidate" :rules="ruleValidate" :label-width="80">
            <Form-item label="用例名称" prop="pdt_name">
                <i-input v-model="formValidate.pdt_name" placeholder="请输入产品名称"></i-input>
            </Form-item>
            <Form-item label="所属产品" prop="version">
                <i-Select v-model="case_pdt0" size="large" style="width:100px" >
                    <i-Option v-for="(item,index) in case_pdt ":key="item.pdt_id" :value="item.pdt_id">{{ item.pdt_name }}</i-Option>
                </i-Select>
            </Form-item>
            <Form-item label="类型" prop="host">
                <Radio-Group v-model="formValidate.pdt_name" >
                    <Radio label="1">性能</Radio>
                    <Radio label="2">接口</Radio>
                </Radio-Group>
            </Form-item>
            <Form-item label="API列表" >
            <!--<cell-group>
                        <Cell title="With Switch">
                            <Form-item label="123" >
                                                <Radio-Group v-model="formValidate.version">
                    <Radio label="1">性能</Radio>
                    <Radio label="2">接口</Radio>
                </Radio-Group>
                                <i-input style="width:100px" v-model="formValidate.version" placeholder="请输入产品版本号 "></i-input>
                            </Form-item>

                        </Cell>



                </cell-group>

-->
                <ul>
                    <ol v-for="(item,index) in case_apidata">
                        <Checkbox v-model="case_apidata[index].has_token" ></Checkbox>
<!--                        <Poptip trigger="hover"  content="index">
                            <i-input type="text" style="width:270px" v-model="case_apidata[index].api_name" disabled ></i-input>
                        </Poptip>-->
                        <Tooltip placement="top" max-width="2000" theme="light">
                            <i-input type="text" style="width:270px" v-model="case_apidata[index].api_name" disabled ></i-input>
                            <div slot="content">
                                {{case_apidata[index].api_name}}

                            </div>
                        </Tooltip>
                        <i-input type="text" style="width:50px" v-model="case_apidata[index].api_id" style="align:left" ></i-input>
                    </ol>
                </ul>
            </Form-item>
        </i-form>

    </Modal>
    <i-Table :border="showBorder" :stripe="showStripe" :show-header="showHeader"
             :height="fixedHeader ? 250 : ''" :size="tableSize" :data="tableData3" :columns="tableColumns3"></i-Table>

    <Modal
            v-model="editFormVisible"
            title="编辑产品"
            @on-ok="update"
            @on-cancel="cancel"
    >
        <i-form ref="editForm" :model="editForm" :rules="ruleValidate" :label-width="80">
            <Form-item label="产品名称" prop="pdt_name">
                <i-input v-model="editForm.pdt_name" placeholder="请输入产品名称"></i-input>
            </Form-item>
            <Form-item label="产品版本" prop="version">
                <i-input v-model="editForm.version" placeholder="请输入产品版本号 "></i-input>
            </Form-item>
            <Form-item label="产品地址" prop="host">
                <i-input v-model="editForm.host" placeholder="请输入产品地址"></i-input>
            </Form-item>
            <Form-item label="产品描述" prop="description">
                <i-input v-model="editForm.description" placeholder="请输入产品描述"></i-input>
            </Form-item>
            <!--                <Form-item label="文件上传" >
                                <i-input type="file" class="file"  @change="tirggerFile"/>
            &lt;!&ndash;                    <Upload action="//jsonplaceholder.typicode.com/posts/" >
                                    <i-Button icon="ios-cloud-upload-outline">Upload files</i-Button>
                                </Upload>&ndash;&gt;
                            </Form-item>-->
            <Form-item label="api_json" prop="api_json">
                <i-input v-model="editForm.api_json" placeholder="请输入接口字符串"></i-input>
            </Form-item>
        </i-form>

    </Modal>

</div>
<script type="text/javascript">
    var vm = new Vue({
        el: "#app",
        data: function () {
            return {
                case_pdt0:'',
                case_pdt:'',
                case_apidata:'',
                editFormVisible:false,
                editFormRules: {
                    name: [
                        { required: true, message: '请输入姓名', trigger: 'blur' }
                    ]
                },
                editForm: {
                    pdt_id:'' ,
                    pdt_name: '',
                    version: '',
                    host: '',
                    description: '',
                    api_json:'',

                },
                modal1: false,
                formValidate: {
                   type_id:'杭州',
                },
                ruleValidate: {
                    pdt_name: [
                        { required: true, message: '产品名称不能为空', trigger: 'blur' }
                    ],
                    host: [
                        { required: true, message: '产品地址不能为空', trigger: 'blur' }
                    ],
                    version: [
                        { required: true, message: '产品版本不能为空', trigger: 'blur' }
                    ],
                    description: [
                        { required: true, message: '请输入产品描述', trigger: 'blur' },
                    ],
                    api_json: [
                        { required: true, message: '产品接口字符串不能为空', trigger: 'blur' }
                    ]
                },
                tableData3: [

                ],
                showBorder: false, // 显示边框
                showStripe: true, // 是否显示斑马纹
                showHeader: true, // 是否显示头部信息
                showIndex: false, // 是否显示索引
                showCheckbox: true, // 显示多选框
                fixedHeader: false, // 显示滑动
                tableSize: 'default'
            }
        },
        watch:{
            //选择所属产品
            case_pdt0(val,oldval){
                axios.get('' + host + '/api/apiinfo/api?pid=' + val + '')
                    .then(res => {
                        console.log(res)
                        this.case_apidata= res.data.message
                        console.log(this.case_apidata)

                    })
                    .catch(function (error) {
                        console.log(error)
                    });
                 console.log("push+function:"+val)
            },
        },
        computed: {
            tableColumns3 () {
                let columns = []
                if (this.showCheckbox) {
                    columns.push({
                        type: 'selection',
                        width: 60,
                        align: 'center'
                    })
                }
                if (this.showIndex) {
                    columns.push({
                        type: 'index',
                        width: 60,
                        align: 'center'
                    })
                }
                columns.push({
                    title: 'ID',
                    key: 'case_id',
                    sortable: true
                })

                columns.push({
                    title: '用例名称',
                    key: 'case_name'
                })
                columns.push({
                    title: 'Action',
                    key: 'action',
                    render: (h, params) => {
                        return h('div', [
                            h('Button', {
                                props: {
                                    type: 'primary',
                                    size: 'small'
                                },
                                style: {
                                    marginRight: '5px'
                                },
                                on: {
                                    click: () => {
                                        this.show(params.index)
                                    }
                                }
                            }, 'View'),
                            h('Button', {
                                props: {
                                    type: 'error',
                                    size: 'small'
                                },
                                on: {
                                    click: () => {
                                        this.remove(params.index)
                                    }
                                }
                            }, 'Delete')
                        ])
                    }
                })
                console.log("columns"+JSON.stringify(columns))
                return columns
            }
        },
        mounted:function(){
            axios.get(''+host+'/api/caseinfo/caselist')
                .then(res => {
                    console.log(res)
                    this.tableData3 = res.data.message
                    //this.filters=this.tableData3.pdt_name
                })
                .catch(function (error) {
                    console.log(error)
                });
            axios.get(''+host+'/api/product/getproductlist')
                .then(res => {
                    console.log(res)
                    this.case_pdt = res.data.message
                    console.log(this.case_pdt)

                })
                .catch(function (error) {
                    console.log(error)
                });

        },
        methods:{

            //删除按钮
            remove: function (index) {
                console.log('date1' + this.tableData3[index].pdt_id)
                // 格局id删除数据
                var obj = {pdt_id: this.tableData3[index].pdt_id}
                this.tableData3.splice(index, 1)
                // var url = '/api/product/delproduct'
                // 发送异步请求
                axios({
                    url: ''+host+'/api/product/delproduct',
                    method: 'delete',
                    dataType: 'json',
                    headers: {
                        'Content-type': 'application/json;'
                    },
                    data: JSON.stringify(obj),
                }).then(res => {
                    if (res.status === 200) {
                        alert('success')
                        // 更新数据
                        console.log(res.message)
                        this.tableData3.splice(index, 1)
                    } else {
                        alert(res.message)
                    }
                }).catch(function () {
                    alert('服务连接出错了')
                })
            },
            //点击编辑
            show (index) {
                this.editFormVisible=true;
                console.log("shouw"+JSON.stringify(this.tableData3[index]))
                this.editForm=this.tableData3[index];
                //this.editForm.api_json=JSON.parse(this.editForm.api_json)
                console.log("shouw1"+JSON.stringify(this.editForm))
                /*                  this.$Modal.confirm({
                                      title: '编辑产品',
                                      fullscreen:true,
                                      title: '编辑产品',
                                      content: `
                                              产品名称：<input size="35"v-bind:value="${this.tableData3[index].pdt_name}"
                  v-on:input="${this.tableData3[index].pdt_name} = $event.target.value" /><br>
                                             <br>产品版本：<input  size="35"value="${this.tableData3[index].version}"/><br>
                                             <br>产品地址：<input size="35" value="${this.tableData3[index].host}"/><br>
                                             <br>产品描述：<input size="35" value="${this.tableData3[index].description}"/><br>
                                             <br>api_json ：<input  size="35" value=${JSON.stringify(this.tableData3[index].api_json)}/>`,
                                      onOk: () => {
                                          this.$Message.info('点击了确定');
                                          console.log("修改数据:"+JSON.stringify(this.tableData3[index]));
                                          axios({
                                              url: ''+host+'/api/product/updateproduct',
                                              "method": "PUT",
                                              dataType: 'json',
                                              headers: {
                                                  'Content-type': 'application/json;'
                                              },
                                              data: JSON.stringify(this.tableData3[index]),
                                          }).then(function (response){
                                              console.log("修改产品："+JSON.stringify(response))
                                              alert("操作:"+response.data.title+",\n结果:"+response.data.message)
                                              location.reload()

                                          })
                                              .catch(function(error){
                                                  console.log(error)
                                              })

                                      },
                                      onCancel: () => {
                                          this.$Message.info('点击了取消');
                                      }
                                  })*/
            },
            //添加弹窗点击确定
            ok () {
                let api_json = JSON.parse(this.formValidate.api_json )
                this.formValidate.api_json=api_json
                console.log("123:"+JSON.stringify(this.formValidate));
                axios({
                    url: ''+host+'/api/product/addproducts',
                    method: 'post',
                    dataType: 'json',
                    headers: {
                        'Content-type': 'application/json;'
                    },
                    data: JSON.stringify(this.formValidate),
                }).then(function (response){
                    console.log(response)
                    alert("操作:"+response.data.title+",\n结果:"+response.data.message)
                    location.reload()

                })
                    .catch(function(error){
                        alert("请求超时")
                        console.log(error)
                    })

            },
            //编辑
            update() {
                console.log("修改:"+JSON.stringify(this.editForm));
                this.editForm.api_json=JSON.parse(this.editForm.api_json)
                axios({
                    url: ''+host+'/api/product/updateproduct',
                    method: 'put',
                    dataType: 'json',
                    headers: {
                        'Content-type': 'application/json;'
                    },
                    data: JSON.stringify(this.editForm),
                }).then(function (response){
                    console.log(response)
                    alert("操作:"+response.data.title+",\n结果:"+response.data.message)
                    location.reload()

                })
                    .catch(function(error){
                        console.log(error)
                    })

            },
            cancel () {
                this.$Message.info('已取消');
                this.formValidate = {
                    pdt_name: '123',
                    version: '',
                    host: '',
                    description: '',
                    api_json: ''
                };
                //location.reload()
            },

        }
    });
</script>
</body>

</html>
